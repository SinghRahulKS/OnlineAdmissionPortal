@using static Entity.Enums.Enum
@model IEnumerable<OnlineAdmissionPortal.Models.UserModel>
@inject IConfiguration _config
<div ng-app="app">
    <div ng-controller="userCtrl">
        <div class="row pt-4">
            <div class="col-6 d-flex">
                <p class="text-primary" ng-click="getUsers(user)"><i class="fa-solid fa-user"></i> Users</p>
            </div>
            <div class="col-6 d-flex justify-content-end">
                <a asp-area="Identity" asp-page="/Account/Register" class="text-decoration-none">
                    <i class="fa-solid fa-user-plus"></i>  Add User
                </a>
            </div>
        </div>

        <div class="border bg-white">
            <br />
            <div class="col-12" ng-init="userFilter.currentPage=1;userFilter.pageSize=@_config["Pagination:PageSize"]; getUsers(userFilter)">
                <div class="col-12 col-lg-12 card-box border p-2 p-sm-3 mb-2">
                    <form class="row" ng-submit="userFilter.currentPage=1;getUsers(userFilter)">
                        <div class="col col-xs-12">
                            @Html.TextBox("FirstName", "", new { @placeholder = "Search First Name", @ng_model = "userFilter.FirstName", @class = "form-control no-radius", @ng_keyup = "userFilter.currentPage=1;getUsers(userFilter)" })
                        </div>
                        <div class="col col-xs-12">
                            @Html.TextBox("UserName", "", new { @placeholder = "Search UserName", @ng_model = "userFilter.UserName", @class = "form-control input-sm", @ng_keyup = "userFilter.currentPage=1;getUsers(userFilter)" })
                        </div>
                        <div class="col col-xs-12">
                            <select ng-model="userFilter.RoleName" class="form-control input-sm" aria-required="true" ng-change="userFilter.currentPage=1;getUsers(userFilter)">
                                <option value="" disabled selected hidden>Select Role</option>
                                @foreach (var item in Html.GetEnumSelectList<Role>())
                                {
                                    <option value="@item.Text.ToString()">@item.Text.ToString()</option>
                                }
                            </select>
                            @*  @Html.TextBox("RoleName", "", new { @placeholder = "Search RoleName.", @ng_model = "userFilter.RoleName", @class = "form-control input-sm", @ng_keyup = "$event.keyCode == 13 ? getUsers(userFilter) : null" })*@
                        </div>
                        <div class="col col-xs-12">
                            <a class="btn btn-primary m--w-100" ng-click="userFilter.currentPage=1;getUsers(userFilter)"><i class="fa-solid fa-magnifying-glass"></i> Search </a>
                        </div>
                        <div class="col col-xs-12">
                            <a class="btn btn-outline-danger" ng-click="userFilter.currentPage=1;clearFilter(userFilter)" title="Clear Filter"><i class="fa-solid fa-xmark"></i> Clear</a>
                        </div>
                    </form>
                </div>
                <table class="table table-striped border">
                    <tr class="table-secondary">
                        <th>
                            @Html.DisplayNameFor(m => m.FirstName)
                        </th>
                        <th>
                            @Html.DisplayNameFor(m => m.LastName)
                        </th>
                        <th>
                            @Html.DisplayNameFor(m => m.UserName)
                        </th>
                        <th>
                            @Html.DisplayNameFor(m => m.RoleName)
                        </th>
                        <th>
                            @if (User.IsInRole("SuperAdmin"))
                            {
                                <p>Action</p>
                            }
                        </th>
                    </tr>

                    <tr ng-repeat="user in userList track by $index">
                        <td ng-bind="user.firstName"></td>
                        <td ng-bind="user.lastName"></td>
                        <td ng-bind="user.userName"></td>
                        <td ng-bind="user.roleName"></td>
                        <td>
                            @if (User.IsInRole("SuperAdmin"))
                            {
                                <a class="text-success ms-sm-2 m-1" data-bs-target="#editMember" ng-click="userEdit(user)" title="Edit User" ng-show="user.userName!='@User.Identity?.Name'">
                                    <i class="fa fa-edit"></i>
                                </a>

                                <a class="text-danger ms-sm-2 m-1" data-bs-target="#deleteMember" ng-click="userDelete(user.userId)" title="Delete User" ng-show="user.userName!='@User.Identity?.Name'">
                                    <i class='fa fa-trash'></i>
                                </a>
                            }
                        </td>
                    </tr>
                </table>
            </div>
            <!--Modal Container for delete confirmation-->
            <div class="modal" data-bs-backdrop="static" tabindex="-1" role="dialog" id="deleteMember">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Delete Confirmation</h5>
                        </div>
                        <div class="modal-body">
                            <p class="text-start">Are you sure you want to delete this User ?</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                            <a class="btn btn-danger" ng-click="deleteUser()">Delete</a>
                        </div>
                    </div>
                </div>
            </div>
            <!--Modal Container For Edit user Functionality-->
            <div class="modal" data-bs-backdrop="static" tabindex="-1" role="dialog" id="editMember">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Edit User</h5>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-12">
                                    <!--Form Starts here-->
                                    <form method="post" name="editForm" novalidate>
                                        <div class="row g-0">
                                            <div class="col-4 align-self-center">
                                                <label class="text-center fw-bold">First Name</label>
                                            </div>
                                            <div class="col-8">
                                                <div class="form-floating my-2">
                                                    <input ng-model="userDetails.firstName" name="firstName" class="form-control" maxlength="20" ng-pattern="validationConstants.onlyText" required />
                                                    <span class="text-danger" ng-if="editForm.firstName.$error.required"> First Name is Required! </span>
                                                    <span class="text-danger" ng-if="editForm.firstName.$dirty&&editForm.firstName.$error.pattern">Please Enter Valid First Name</span>
                                                </div>
                                            </div>
                                            <div class="col-4 align-self-center">
                                                <label class="text-start fw-bold">Last Name</label>
                                            </div>
                                            <div class="col-8">
                                                <div class="form-floating my-2">
                                                    <input ng-model="userDetails.lastName" name="lastName" class="form-control" maxlength="20" ng-pattern="validationConstants.onlyText" required />
                                                    <span class="text-danger" ng-if="editForm.lastName.$error.required">Last Name is Required! </span>
                                                    <span class="text-danger" ng-if="editForm.lastName.$dirty&&editForm.lastName.$error.pattern">Please Enter Valid Last Name</span>
                                                </div>
                                            </div>
                                            <div class="col-4 align-self-center">
                                                <label class="text-start fw-bold">Email</label>
                                            </div>
                                            <div class="col-8">
                                                <div class="form-floating my-2">
                                                    <input ng-model="userDetails.userName" title="Email can't update" name="userName" class="form-control" required disabled />
                                                    <span class="text-danger" ng-if="editForm.userName.$error.required"> Required! </span>
                                                </div>
                                            </div>
                                            <div class="col-4 align-self-center">
                                                <label class="text-start fw-bold">Role</label>
                                            </div>
                                            <div class="col-8">
                                                <div class="form-floating my-2">
                                                    <select ng-model="userDetails.roleName" class="form-control" aria-required="true">
                                                        <option value="" disabled selected hidden>Select Role</option>
                                                        @foreach (var item in Html.GetEnumSelectList<Role>())
                                                        {
                                                            <option value="@item.Text.ToString()">@item.Text.ToString()</option>
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <!--Action buttons for edit user modal-->
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-info text-white" ng-click="updateUser(userDetails)" ng-disabled="editForm.$invalid">Update</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row pt-3">
            <div class="col-12  col-lg-12 d-flex justify-content-evenly">
                <div paging
                     page="page"
                     page-size="pageSize"
                     total="total"
                     text-next="next"
                     text-prev="prev"
                     show-prev-next="true"
                     show-first-last="false"
                     disabled="false"
                     adjacent="2"
                     class="small"
                     text-next-class="pagination-border-less-next"
                     text-prev-class="pagination-border-less-prev"
                     paging-action="userFilter.currentPage=page;userFilter.pageSize=pageSize;getUsers(userFilter);">
                </div>
            </div>
        </div>
    </div>
</div>
<link href="~/css/pagination.min.css" rel="stylesheet" />