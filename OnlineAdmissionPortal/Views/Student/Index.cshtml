
@model IEnumerable<OnlineAdmissionPortal.Models.StudentModel>
@inject IConfiguration _config
<div class="container my-4" ng-controller="admissionCtrl">
    <div class="row pt-4">
        <div class="col-6 d-flex">
            <p class="text-primary" ng-click="getStudents(student)"><i class="fa-solid fa-user"></i> Students</p>
        </div>
        <div class="col-6 d-flex justify-content-end">
            <a asp-controller="Student" asp-action="Create" class="text-decoration-none">
                <i class="fa-solid fa-user-plus"></i> Add Student
            </a>
        </div>
    </div>

    <div class="border bg-white">
        <br />
        <div class="col-12" ng-init="studentFilter.currentPage=1;studentFilter.pageSize=@_config["Pagination:PageSize"]; getStudents(studentFilter)">
            <div class="col-12 col-lg-12 card-box border p-2 p-sm-3 mb-2">
                <form class="row" ng-submit="studentFilter.currentPage=1;getStudents(studentFilter)">
                    <div class="col col-xs-12">
                        @Html.TextBox("Email", "", new { @placeholder = "Search Email", @ng_model = "studentFilter.Email", @class = "form-control no-radius", @ng_keyup = "studentFilter.currentPage=1;getStudents(studentFilter)" })
                    </div>
                    <div class="col col-xs-12">
                        @Html.TextBox("Phone", "", new { @placeholder = "Search Phone", @ng_model = "studentFilter.Phone", @class = "form-control input-sm", @ng_keyup = "studentFilter.currentPage=1;getStudents(studentFilter)" })
                    </div>
                    <div class="col col-xs-12">
                        <a class="btn btn-primary m--w-100" ng-click="studentFilter.currentPage=1;getStudents(studentFilter)"><i class="fa-solid fa-magnifying-glass"></i> Search </a>
                    </div>
                    <div class="col col-xs-12">
                        <a class="btn btn-outline-danger" ng-click="studentFilter.currentPage=1;clearFilter(studentFilter)" title="Clear Filter"><i class="fa-solid fa-xmark"></i> Clear</a>
                    </div>
                </form>
            </div>
            <table class="table table-striped border">
                <tr class="table-secondary">
                    <th>
                        @Html.DisplayNameFor(m => m.FName)
                    </th>
                    <th>
                        @Html.DisplayNameFor(m => m.LName)
                    </th>
                    <th>
                        @Html.DisplayNameFor(m => m.Email)
                    </th>
                    <th>
                        @Html.DisplayNameFor(m => m.Phone)
                    </th>
                    <th>
                        @Html.DisplayNameFor(m => m.DateOfBirth)
                    </th>
                    <th>
                        @Html.DisplayNameFor(m => m.Address)
                    </th>
                    <th>
                        @Html.DisplayNameFor(m => m.CreatedBy)
                    </th>
                    <th>
                        <p>Action</p>
                    </th>
                </tr>

                <tr ng-repeat="student in studentList track by $index">
                    <td ng-bind="student.fName"></td>
                    <td ng-bind="student.lName"></td>
                    <td ng-bind="student.email"></td>
                    <td ng-bind="student.phone"></td>
                    <td>
                        <!-- Display formatted DateOfBirth -->
                        <span>{{ student.dateOfBirth | date:'yyyy-MM-dd' }}</span>
                    </td>
                    <td ng-bind="student.address"></td>
                    <td>
                        <a class="text-success ms-sm-2 m-1" data-bs-target="#editMember" ng-click="studentEdit(student)" title="Edit Student">
                            <i class="fa fa-edit"></i>
                        </a>
                        <a class="text-danger ms-sm-2 m-1" data-bs-target="#deleteMember" ng-click="studentDelete(student.id)" title="Delete Student">
                            <i class="fa fa-trash"></i>
                        </a>
                    </td>
                </tr>
            </table>

        </div>
    </div>
    <div class="row pt-3">
        <div class="col-12  col-lg-12 d-flex justify-content-evenly">
            <div paging
                 page="page"
                 page-size="pageSize"
                 total="total"
                 text-next="next"
                 text-prev="prev"
                 show-prev-next="true"
                 show-first-last="false"
                 disabled="false"
                 adjacent="2"
                 class="small"
                 text-next-class="pagination-border-less-next"
                 text-prev-class="pagination-border-less-prev"
                 paging-action="studentFilter.currentPage=page;studentFilter.pageSize=pageSize;getStudents(studentFilter);">
            </div>
        </div>
    </div>
</div>

<!--Modal Container for delete confirmation-->
<div class="modal" data-bs-backdrop="static" tabindex="-1" role="dialog" id="deleteMember">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Confirmation</h5>
            </div>
            <div class="modal-body">
                <p class="text-start">Are you sure you want to delete this User ?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                <a class="btn btn-danger" ng-click="deleteStudent()">Delete</a>
            </div>
        </div>
    </div>
</div>
<!--Modal Container For Edit user Functionality-->
<div class="modal" data-bs-backdrop="static" tabindex="-1" role="dialog" id="editMember">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit User</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12">
                        <!--Form Starts here-->
                        <form method="post" name="editForm" novalidate>
                            <div class="row g-0">
                                <div class="col-4 align-self-center">
                                    <label class="text-center fw-bold">First Name</label>
                                </div>
                                <div class="col-8">
                                    <div class="form-floating my-2">
                                        <input ng-model="userDetails.fName" name="fName" class="form-control" maxlength="20" ng-pattern="validationConstants.onlyText" required />
                                        <span class="text-danger" ng-if="editForm.fName.$error.required"> First Name is Required! </span>
                                        <span class="text-danger" ng-if="editForm.fName.$dirty&&editForm.fName.$error.pattern">Please Enter Valid First Name</span>
                                    </div>
                                </div>
                                <div class="col-4 align-self-center">
                                    <label class="text-start fw-bold">Last Name</label>
                                </div>
                                <div class="col-8">
                                    <div class="form-floating my-2">
                                        <input ng-model="userDetails.lName" name="lName" class="form-control" maxlength="20" ng-pattern="validationConstants.onlyText" required />
                                        <span class="text-danger" ng-if="editForm.lName.$error.required">Last Name is Required! </span>
                                        <span class="text-danger" ng-if="editForm.lName.$dirty&&editForm.lName.$error.pattern">Please Enter Valid Last Name</span>
                                    </div>
                                </div>
                                <div class="col-4 align-self-center">
                                    <label class="text-start fw-bold">Email</label>
                                </div>
                                <div class="col-8">
                                    <div class="form-floating my-2">
                                        <input ng-model="userDetails.userName" title="Email can't update" name="userName" class="form-control" required disabled />
                                        <span class="text-danger" ng-if="editForm.userName.$error.required"> Required! </span>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!--Action buttons for edit user modal-->
            <div class="modal-footer">
                <button type="submit" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-info text-white" ng-click="updateUser(userDetails)" ng-disabled="editForm.$invalid">Update</button>
            </div>
        </div>
    </div>
</div>

<link href="~/css/pagination.min.css" rel="stylesheet" />